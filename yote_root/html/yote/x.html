<html>
<head>
<STYLE>
     //    .up_to_date{background-color:#FFDD73}
     //    .needs_update{background-color:#FFC000}
    .up_to_date{background-color:#EAEEEA}
    .needs_update{background-color:#FFEEEE}
    table{background-color:#FFC473}
    //    body{background-color:#FFAE40}
    body{background-color:#D1B58D}
    h1{background-color:#FF9400}
    .picked{background-color:yellow}
    .sitting{background-color:#EEEEEE}
    .hovering{background-color:lightyellow}
</STYLE>

    <script src="/yote/js/jquery-latest.js"></script>
    <script src="/yote/js/jquery.dumper.js"></script>
    <script src="/yote/js/jquery.cookie.js"></script>
    <script src="/yote/js/jquery.base64.min.js"></script>
    <script src="/yote/js/json2.js"></script>
    <script src="/yote/js/yote.js"></script>
    <script src="/yote/js/yote.util.js"></script>
    <script src="/yote/js/yote.system.util.js"></script>

<SCRIPT lang="javascript">
      var UIMaster = {
        active_app:undefined,
        all_apps:[],

        app_under_mouse:function( X, Y ) {
          for( var idx in this.all_apps ) {
              var targ = this.all_apps[idx].target;
              var topleft = $( targ ).offset();
              var w = $( targ ).width();
              var h = $( targ ).height();
              if( X >= topleft.left && X <= topleft.left + w &&
                  Y >= topleft.top && Y <= topleft.top + h ) {
                  return this.all_apps[idx];
              }
          }
          return undefined;
        }, //app_under_mouse


        make_objlist:function(target,obj_type,objs) {
          var master = this;

          var objlist = {
              obj_type:obj_type,
              target:target,
              objs:[],

              accept:function(obj,x,y) {
                  if( obj.obj_type !== this.obj_type ) {
                      return false;
                  }
                  // could add additional checks for eligibility passed to make_objlist
                  var wl = this;
                  var already_in = false;
                  for( var idx in wl.objs ) {
                      if( obj.id == this.objs[idx].id ) {
                          already_in = true;
                          break;
                      }
                  }
                  if( already_in == false ) {
                      wl.objs.push( obj );
                      var odiv = master.detached_obj_divs[ obj.obj_type ][ obj.id ];
                      odiv.appendTo( wl.target + ' #wl' );
                      odiv.offset( { left:odiv.offset().left, top:odiv.offset().top+ 5 } );
                      if( typeof x !== 'undefined' && typeof y !== 'undefined' ) {
                          odiv.offset( { left:x, top:y } );
                      }
                  } //if needs to be added in
                  if( typeof x !== 'undefined' && typeof y !== 'undefined' ) {
                      this.reorder();
                  }
                  return true;
              }, //accept

              give:function( obj ) {
                  for( var idx in this.objs ) {
                      if( obj.id == this.objs[idx].id ) {
                          this.objs.splice( idx, 1 );
                          break;
                      }
                  }
              }, //give

              reorder:function() {
                  this.objs.sort( function(a,b) {
                                      return $( '#' + a.obj_type + '_' + a.id ).offset().top - $( '#' + b.obj_type + '_' + b.id ).offset().top;
                                  } );
                  var X = $( this.target ).offset().left + 5;
                  var startY = $( this.target ).offset().top + 5;
                  for( idx in this.objs ) {
                      obj = this.objs[idx];
                      var wb = '#' + obj.obj_type + '_' + obj.id;
                      $( wb ).offset( { left:X, top:startY } );
                      startY = startY + $( wb ).height() + 5;
                  }
              }, //reorder

              init:function() { //objlist
                  var wl = this;
                  $( this.target ).append( '<div id=wl></div>' );
                  var pos = 0;
                  objs = objs || [];
                  for( idx in objs ) {
                      wl.accept( objs[idx] );
                  } //foreach
              }, //init
          };
          objlist.init();
          master.all_apps.push( objlist );
          return objlist;
      }, //make_objlist

      selected_obj:undefined,
      detached_obj_divs:{},
      pos_x:0,
      pos_y:0,

      init:function() { //UIMaster
          var master = this;
          $( '*' ).mouseup(  function(event) {
                                 var oapp = master.app_under_mouse( event.pageX, event.pageY );
                                 var aapp = master.active_app;

                                 var obj = master.selected_obj;
                                 if( typeof obj !== 'undefined' ) {
                                     var sel = '#' + obj.id;
                                     $( sel ).removeClass( 'picked' );
                                     $( sel ).addClass( 'hovering' );
                                     $( sel ).detach().appendTo( 'body' );
                                     if( typeof oapp !== 'undefined' ) {
                                         if( typeof aapp !== 'undefined' ) {
                                             aapp.give( obj );
                                             aapp = undefined;
                                         }
                                         oapp.accept( obj, master.pos_x, master.pos_y );
                                     } else if( typeof aapp !== 'undefined' ) {
                                         aapp.accept( obj, master.pos_x, master.pos_y );
                                     }
                                     master.selected_obj = undefined;
                                 }
                             } );
          $( '*' ).mousemove( function(event) {
                                  if( typeof master.selected_obj !== 'undefined' ) {
                                      var wl = master.selected_obj;
                                      var w = master.selected_obj.id;
                                      var t = master.selected_obj.obj_type;
                                      var x = $( '#' + t + '_' + w ).offset().left + (event.pageX - master.pos_x);
                                      var y = $( ' #' + t + '_' + w ).offset().top + (event.pageY - master.pos_y);
                                      master.pos_x = event.pageX;
                                      master.pos_y = event.pageY;
                                      $( '#' + t + '_' + w ).offset( { left:x, top:y } );
                                  }
                              } );

      }, //init (UIMaster)

      topid:0,
      all_objs:{},

      mk_obj:function( title, obj_type, data ) {
          var master = this;
          master.topid++;
          var obj = {
              obj_type:obj_type,
                  title:title,
                  data:data,
                  id:master.topid,
                  };
          if( typeof master.all_objs[ obj_type ] === 'undefined' ) {
              master.all_objs[ obj_type ] = {};
              master.detached_obj_divs[ obj_type ] = {};
          }
          master.all_objs[obj_type][master.topid] = obj;
          $('#main').append( '<div id=' + obj.obj_type + '_' + obj.id + ' style="height:30;width:90;margin:5" class=sitting>' + obj.title + '</div>' );
          var sel = '#' + obj.obj_type + '_' + obj.id;
          $( sel ).mousedown(  (function(w) { return function(event) {
                                        $( '#' + w.obj_type + '_' + w.id ).addClass( 'picked' );
                                        $( '#' + w.obj_type + '_' + w.id ).removeClass( 'hovering' );
                                        var aapp = master.app_under_mouse( event.pageX, event.pageY );
                                        if( typeof aapp !== 'undefined' ) {
                                            aapp.selected_obj = w;
                                            master.active_app = aapp;
                                        }
                                        master.selected_obj = w;
                                        master.pos_x = event.pageX;
                                        master.pos_y = event.pageY;
                                   } } )(obj));
          $( sel ).mouseenter( (function(w) { return function() {
                                        if( typeof master.selected_obj === 'undefined' ) {
                                           $( '#' + w.obj_type + '_' + w.id ).addClass( 'hovering' );
                                           $( '#' + w.obj_type + '_' + w.id ).removeClass( 'sitting' );
                                        }
                                    }} )(obj) );

          $( sel ).mouseleave( (function(w) { return function() {
                                        $( '#' + w.obj_type + '_' + w.id ).addClass( 'sitting' );
                                        $( '#' + w.obj_type + '_' + w.id ).removeClass( 'hovering' );

                                    } } )(obj) );
          $( sel ).css( 'z-index', 1 );
          master.detached_obj_divs[obj_type][obj.id] = $( sel ).detach();

          return obj;
      } //mk_obj (UIMaster)
    } //UIMaster


$().ready(function() {

    $('#main').append( "<div id=info>Over : <span id=over></span><BR></div>" );
    $('#main').append( '<div id=wldiv></div>' );
    $('#wldiv').css('background-color','lightblue');
    $('#wldiv').height( 500 );
    $('#wldiv').width( 100 );
    $('#main').append( '<div id=odiv></div>' );
    $('#odiv').height( 500 );
    $('#odiv').width( 100 );
    $('#odiv').offset( { left:120, top:$('#wldiv').offset().top } );
    $('#odiv').css('background-color','lightgreen');

    UIMaster.init();
    UIMaster.make_objlist('#wldiv','t',Array( UIMaster.mk_obj("A","t",{}), UIMaster.mk_obj("B","t",{}) ) );
    var wl = UIMaster.make_objlist('#odiv','t');
   wl.accept( UIMaster.mk_obj("C","t",{}) );

    return;
</script>
 </head>

 <body>

   <h1>X</h1>
<div id=main></div>

 </body>
</html>
